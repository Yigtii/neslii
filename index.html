<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Kalp Toplama Oyunu</title>
  <style>
    body {
      margin: 0;
      background: linear-gradient(to bottom, #ffd1dc, #fff);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow: hidden;
      user-select: none;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    #gameCanvas {
      background-color: #ffecf2;
      margin: 20px auto;
      border-radius: 10px;
      touch-action: none;
      box-shadow: 0 0 15px rgba(233, 30, 99, 0.6);
      display: none;
      max-width: 100vw;
      width: 400px;
      height: 600px;
    }

    #startButton {
      display: block;
      margin: 20px auto;
      background: #e91e63;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 18px;
      border-radius: 12px;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s;
      box-shadow: 0 4px 8px rgba(233,30,99,0.4);
      max-width: 90vw;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    #startButton:hover {
      background: #c2185b;
    }

    #counterBox {
      text-align: center;
      font-size: 22px;
      color: #e91e63;
      font-weight: 700;
      user-select: none;
      text-shadow: 0 0 8px #f48fb1;
      margin-top: 10px;
      min-height: 30px;
      max-width: 90vw;
      margin-left: auto;
      margin-right: auto;
      word-break: break-word;
    }

    #messageBox {
      position: fixed;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      max-width: 90vw;
      width: 380px;
      background: #fce4ecdd;
      border: 2px solid #e91e63;
      border-radius: 15px;
      padding: 15px 20px;
      font-size: 20px;
      font-weight: 600;
      font-style: italic;
      color: #880e4f;
      text-align: center;
      user-select: none;
      box-shadow: 0 0 15px #e91e63bb;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.5s ease, visibility 0.5s ease;
      z-index: 10;
      line-height: 1.4;
      word-break: break-word;
      white-space: normal;
    }
    #messageBox.visible {
      visibility: visible;
      opacity: 1;
    }

    #endMessage {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      max-width: 90vw;
      width: 400px;
      background: #ffd1dccc;
      border-radius: 20px;
      padding: 25px 30px;
      font-size: 22px;
      font-family: 'Georgia', serif;
      color: #880e4f;
      font-weight: 700;
      line-height: 1.6;
      box-shadow: 0 0 30px #c2185b;
      user-select: none;
      white-space: pre-line;
      display: none;
      z-index: 20;
      text-align: center;
      word-break: break-word;
    }

    /* Responsive font size & canvas scale */
    @media (max-width: 450px) {
      #gameCanvas {
        width: 90vw;
        height: calc(90vw * 1.5); /* Maintain aspect ratio 400x600 = 2:3 */
      }
      #counterBox {
        font-size: 18px;
      }
      #messageBox {
        font-size: 18px;
        width: 90vw;
        padding: 12px 16px;
      }
      #endMessage {
        font-size: 18px;
        width: 90vw;
        padding: 20px 25px;
      }
    }
  </style>
</head>
<body>

  <button id="startButton">Oyuna Bala 歹</button>
  <canvas id="gameCanvas" width="400" height="600"></canvas>

  <div id="counterBox"></div>
  <div id="messageBox"></div>
  <div id="endMessage"></div>

  <!-- Ses dosyalar覺 -->
  <audio id="soundHeart" src="klp.mp3" preload="auto"></audio>
  <audio id="soundMsg" src="msg.mp3" preload="auto"></audio>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const startButton = document.getElementById('startButton');
    const messageBox = document.getElementById('messageBox');
    const counterBox = document.getElementById('counterBox');
    const endMessage = document.getElementById('endMessage');

    // Ses elementleri
    const soundHeart = document.getElementById('soundHeart');
    const soundMsg = document.getElementById('soundMsg');

    let player = { x: 175, y: 570, width: 50, height: 20 };
    let hearts = [];
    let caughtCount = 0;
    const targetCount = 50;
    let gameStarted = false;
    let gameOver = false;
    let messageTimeoutId = null;

    const messages = [
      "Seninle tan覺t覺覺m i癟in asla piman deilim.",
      "Beraber ge癟irdiimiz zaman en k覺ymetlisi.",
      "Seninle her ey daha anlaml覺.",
      "Utand覺覺nda yanaklar覺n覺n k覺zarmas覺, i癟imi 覺s覺t覺yor 云.",
      "襤yi ki vars覺n, beni mutlu ediyorsun.",
      "Kalbim 繹lene kadar seninle."
    ];

    function drawPlayer() {
      ctx.fillStyle = '#e91e63';
      ctx.fillRect(player.x, player.y, player.width, player.height);
      ctx.strokeStyle = 'rgba(255,255,255,0.6)';
      ctx.lineWidth = 2;
      ctx.strokeRect(player.x + 3, player.y + 3, player.width - 6, player.height - 6);
    }

    function drawHeart(h) {
      let fontSize = 30;
      if (window.innerWidth <= 450) fontSize = 24;
      ctx.font = `${fontSize}px Arial`;
      ctx.shadowColor = 'rgba(233,30,99,0.7)';
      ctx.shadowBlur = 10;
      ctx.fillText('歹', h.x, h.y);
      ctx.shadowBlur = 0;
    }

    function spawnHeart() {
      const x = Math.random() * (canvas.width - 30) + 15;
      hearts.push({ x: x, y: 0 });
    }

    function updateGame() {
      if (!gameStarted || gameOver) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      for (let i = hearts.length - 1; i >= 0; i--) {
        hearts[i].y += 2;
        drawHeart(hearts[i]);

        if (
          hearts[i].x > player.x &&
          hearts[i].x < player.x + player.width &&
          hearts[i].y > player.y &&
          hearts[i].y < player.y + player.height
        ) {
          hearts.splice(i, 1);
          caughtCount++;
          updateCounter();

          // Kalp toplama sesi
          playSound(soundHeart);

          if (caughtCount % 10 === 0) {
            showMessage(messages[(caughtCount / 10) - 1]);
          }

          if (caughtCount >= targetCount) {
            gameOver = true;
            showEndMessage();
            return;
          }
        } else if (hearts[i].y > canvas.height + 20) {
          hearts.splice(i, 1);
        }
      }

      drawPlayer();

      if (Math.random() < 0.02) {
        spawnHeart();
      }

      requestAnimationFrame(updateGame);
    }

    function updateCounter() {
      counterBox.textContent = `Toplanan Kalpler: ${caughtCount} / ${targetCount}`;
    }

    function showMessage(text) {
      clearTimeout(messageTimeoutId);
      messageBox.textContent = text;
      messageBox.classList.add('visible');

      // Mesaj sesi
      playSound(soundMsg);

      messageTimeoutId = setTimeout(() => {
        messageBox.classList.remove('visible');
      }, 10000);
    }

    function showEndMessage() {
      messageBox.textContent = '';
      messageBox.classList.remove('visible');
      counterBox.textContent = '';

      endMessage.style.display = 'block';
      endMessage.innerHTML = `Her ne kadar odun olsan da,
ben seni bu halinle seviyorum.

Bana ila癟 gibi geliyorsun 
ve seninle ge癟irdiim her vakitten keyif al覺yorum.

Sadece bir oyun deil bu,
bu sat覺rlar覺 yazarken bile akl覺mda hep sen vard覺n Neslihan.

襤yi ki hayat覺mdas覺n, seni seviyorum.`;
    }

    // Ses oynatma fonksiyonu
    function playSound(audioElement) {
      // Ayn覺 anda tekrar oynat覺lmak istendiinde sesi baa al覺p oynat覺r
      audioElement.pause();
      audioElement.currentTime = 0;
      audioElement.play().catch(e => {
        // Oynatma hatalar覺 burada yakalanabilir (繹rnein kullan覺c覺 etkileimi olmadan otomatik oynatma engellenirse)
        // 襤stersen burada hata logu veya sessizce ge癟i yapabilirsin
      });
    }

    let isMouseDown = false;

    // Fare olaylar覺
    canvas.addEventListener('mousedown', () => isMouseDown = true);
    canvas.addEventListener('mouseup', () => isMouseDown = false);
    canvas.addEventListener('mouseleave', () => isMouseDown = false);
    canvas.addEventListener('mousemove', e => {
      if (isMouseDown && !gameOver) {
        const rect = canvas.getBoundingClientRect();
        const mouseX = e.clientX - rect.left;
        player.x = mouseX - player.width / 2;
        if (player.x < 0) player.x = 0;
        if (player.x > canvas.width - player.width) player.x = canvas.width - player.width;
      }
    });

    // Dokunmatik olaylar (mobil i癟in)
    canvas.addEventListener('touchstart', e => {
      e.preventDefault();
      if (!gameOver) {
        const rect = canvas.getBoundingClientRect();
        const touchX = e.touches[0].clientX - rect.left;
        player.x = touchX - player.width / 2;
        if (player.x < 0) player.x = 0;
        if (player.x > canvas.width - player.width) player.x = canvas.width - player.width;
      }
    }, { passive: false });

    canvas.addEventListener('touchmove', e => {
      e.preventDefault();
      if (!gameOver) {
        const rect = canvas.getBoundingClientRect();
        const touchX = e.touches[0].clientX - rect.left;
        player.x = touchX - player.width / 2;
        if (player.x < 0) player.x = 0;
        if (player.x > canvas.width - player.width) player.x = canvas.width - player.width;
      }
    }, { passive: false });

    startButton.addEventListener('click', () => {
      gameStarted = true;
      gameOver = false;
      caughtCount = 0;
      hearts = [];
      player.x = canvas.width / 2 - player.width / 2;

      startButton.style.display = 'none';
      canvas.style.display = 'block';
      messageBox.textContent = '';
      messageBox.classList.remove('visible');
      endMessage.style.display = 'none';
      updateCounter();

      updateGame();
    });
  </script>
</body>
</html>
